<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Shah Ghouse √ó MenuVista ‚Äî 3D + AR Demo</title>

  <meta name="description" content="Shah Ghouse √ó MenuVista AR Demo. Explore 5 signature dishes in 3D and view them in AR." />

  <!-- model-viewer -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    :root{
      --bg:#ffffff;
      --text:#0f172a;
      --sub:#475569;
      --line:rgba(15, 23, 42, 0.12);
      --shadow: 0 12px 32px rgba(2,6,23,0.08);

      /* Shah Ghouse inspired green */
      --green:#16a34a;
      --green2:#15803d;

      --radius:22px;
    }

    *{ box-sizing:border-box; margin:0; padding:0; }
    html{ scroll-behavior:smooth; }
    body{
      background: var(--bg);
      color: var(--text);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      -webkit-tap-highlight-color: transparent;
      line-height: 1.4;
    }
    a{ color:inherit; text-decoration:none; }

    .container{
      width:min(1120px, calc(100% - 40px));
      margin:0 auto;
    }

    /* NAV */
    .nav{
      position: sticky;
      top:0;
      z-index: 999;
      background: rgba(255,255,255,0.82);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--line);
    }
    .nav-inner{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 0;
    }

    .brand{
      display:flex;
      align-items:center;
      gap: 12px;
      font-weight: 900;
      letter-spacing: -0.3px;
    }

    .brandMark{
      width: 42px;
      height: 42px;
      border-radius: 16px;
      display:grid;
      place-items:center;
      background: rgba(22,163,74,0.10);
      border: 1px solid rgba(22,163,74,0.22);
      font-weight: 900;
      font-family: Poppins, Inter, sans-serif;
    }

    .brandTxt{
      display:flex;
      flex-direction: column;
      line-height: 1.1;
    }
    .brandTxt .t1{
      font-family: Poppins, Inter, sans-serif;
      font-size: 15px;
      font-weight: 900;
    }
    .brandTxt .t2{
      font-size: 12px;
      color: var(--sub);
      font-weight: 700;
    }

    .navActions{
      display:flex;
      align-items:center;
      gap: 10px;
    }

    .btn{
      border: 1px solid var(--line);
      background: #fff;
      padding: 10px 14px;
      border-radius: 14px;
      font-weight: 800;
      font-size: 14px;
      cursor: pointer;
      display:inline-flex;
      align-items:center;
      gap: 8px;
      transition: 0.18s ease;
      user-select:none;
    }
    .btn:hover{
      transform: translateY(-1px);
      box-shadow: var(--shadow);
      border-color: rgba(22,163,74,0.22);
    }
    .btn-primary{
      background: linear-gradient(135deg, var(--green), var(--green2));
      border-color: rgba(22,163,74,0.35);
      color: #fff;
      box-shadow: 0 16px 34px rgba(22,163,74,0.20);
    }
    .btn-ghost{
      background: rgba(15,23,42,0.02);
    }

    /* HERO */
    .hero{
      padding: 46px 0 18px;
      position: relative;
      overflow: hidden;
    }
    .hero::before{
      content:"";
      position:absolute;
      inset: -140px -170px auto auto;
      width: 560px;
      height: 560px;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.45;
      background: radial-gradient(circle, rgba(22,163,74,0.55), rgba(22,163,74,0));
      pointer-events:none;
    }

    .hero-grid{
      display:grid;
      grid-template-columns: 1.12fr 0.88fr;
      gap: 18px;
      align-items: center;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(22,163,74,0.22);
      background: rgba(22,163,74,0.08);
      font-weight: 800;
      font-size: 13px;
      color: rgba(15,23,42,0.88);
    }

    .hero h1{
      font-family: Poppins, Inter, sans-serif;
      margin: 12px 0 10px;
      font-size: clamp(28px, 3.4vw, 46px);
      letter-spacing: -1px;
      line-height: 1.05;
    }

    .hero p{
      margin: 0;
      color: var(--sub);
      font-size: 15px;
      max-width: 60ch;
    }

    .heroActions{
      margin-top: 16px;
      display:flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .heroCard{
      border: 1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(15,23,42,0.03), rgba(15,23,42,0.01));
      padding: 16px;
      box-shadow: var(--shadow);
    }
    .mini{
      font-size: 13px;
      color: var(--sub);
      font-weight: 800;
    }

    .stats{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 12px;
    }

    .stat{
      background:#fff;
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 12px;
    }
    .stat .k{
      font-weight: 900;
      font-size: 16px;
      letter-spacing: -0.3px;
    }
    .stat .d{
      margin-top: 4px;
      color: var(--sub);
      font-size: 12px;
      font-weight: 700;
    }

    section{ padding: 36px 0; }

    .section-title{
      display:flex;
      align-items:flex-end;
      justify-content: space-between;
      gap: 14px;
      margin-bottom: 14px;
    }
    .section-title h2{
      margin: 0;
      font-family: Poppins, Inter, sans-serif;
      letter-spacing: -0.5px;
      font-size: 22px;
    }
    .section-title p{
      margin: 0;
      color: var(--sub);
      font-size: 14px;
      max-width: 72ch;
    }

    /* DISH GRID */
    .grid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
    }
    .dish{
      background:#fff;
      border: 1px solid var(--line);
      border-radius: var(--radius);
      overflow:hidden;
      box-shadow: var(--shadow);
      transition: 0.18s ease;
      position:relative;
    }
    .dish:hover{
      transform: translateY(-2px);
      border-color: rgba(22,163,74,0.30);
      box-shadow: 0 18px 46px rgba(22,163,74,0.12);
    }

    .dish-top{
      padding: 14px 14px 0;
      display:flex;
      justify-content: space-between;
      gap: 10px;
      align-items:flex-start;
    }

    .tag{
      display:inline-flex;
      padding: 6px 10px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 12px;
      border: 1px solid rgba(22,163,74,0.22);
      background: rgba(22,163,74,0.08);
      color: rgba(15,23,42,0.90);
      white-space: nowrap;
    }

    .dish h3{
      margin: 0;
      font-size: 16px;
      letter-spacing: -0.3px;
    }
    .dish .subline{
      margin-top: 4px;
      color: var(--sub);
      font-size: 13px;
      font-weight: 700;
    }

    .viewer{
      padding: 12px 14px 0;
    }

    model-viewer{
      width: 100%;
      height: 280px;
      border-radius: 18px;
      border: 1px dashed rgba(15,23,42,0.18);
      background: linear-gradient(180deg, rgba(15,23,42,0.03), rgba(15,23,42,0.01));
      overflow:hidden;
    }

    .dish-actions{
      padding: 12px 14px 14px;
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .btn-wide{
      flex: 1;
      justify-content:center;
      min-width: 140px;
    }

    /* HOW TO */
    .howbox{
      border: 1px solid rgba(22,163,74,0.24);
      background: linear-gradient(135deg, rgba(22,163,74,0.10), rgba(15,23,42,0.02));
      border-radius: 22px;
      padding: 18px;
      box-shadow: var(--shadow);
    }
    .howgrid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-top: 12px;
    }
    .howstep{
      background:#fff;
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 14px;
    }
    .no{
      width: 42px;
      height: 42px;
      border-radius: 16px;
      display:grid;
      place-items:center;
      font-weight: 900;
      background: rgba(22,163,74,0.10);
      border: 1px solid rgba(22,163,74,0.20);
      margin-bottom: 8px;
    }
    .howstep p{
      margin: 0;
      color: var(--sub);
      font-size: 13px;
      font-weight: 700;
    }

    /* FOOTER */
    footer{
      border-top: 1px solid var(--line);
      background: rgba(15,23,42,0.02);
      padding: 22px 0;
      color: var(--sub);
      font-size: 13px;
    }
    .foot{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    /* ================= FALLBACK AR (CAMERA OVERLAY) ================= */
    .fakeArScreen{
      position:fixed; inset:0; z-index:9999;
      background:#000; display:none;
    }
    .fakeArVideo{
      position:absolute; inset:0; width:100%; height:100%;
      object-fit:cover; z-index:1;
    }
    .fakeArViewerWrap{
      position:absolute; inset:0; z-index:2; pointer-events:auto;
    }
    .fakeArOverlay{
      position:absolute; inset:0; z-index:3;
      display:flex; flex-direction:column; justify-content:space-between;
      padding:16px; pointer-events:none;
    }
    .fakeArTopBar, .fakeArBottomBar{
      pointer-events:auto;
      display:flex; align-items:center; justify-content:space-between;
    }
    .fakeArTag{
      padding:8px 12px; border-radius:999px; background:rgba(0,0,0,.6);
      backdrop-filter:blur(10px); font-weight:900; font-size:12px;
      border:1px solid rgba(255,255,255,.2); color:#fff;
    }
    .fakeArClose{
      padding:10px 14px; border-radius:999px; background:rgba(255,50,50,.85);
      color:#fff; border:0; font-weight:900; cursor:pointer; font-size:13px;
    }
    .fakeArBottomBar{
      background:rgba(20,20,30,.85); backdrop-filter:blur(12px);
      padding:14px; border-radius:18px; border:1px solid rgba(255,255,255,.1);
      width: 100%;
    }
    .fakeArTitle{font-weight:900; font-size:15px; color:#fff;}
    .fakeArSub{opacity:.95; font-size:12px; color:#d1d5db; margin-top:2px;}

    /* Loader */
    .loader{
      position:fixed; inset:0; z-index:10000; background:rgba(0,0,0,.75);
      display:none; align-items:center; justify-content:center; flex-direction:column;
      color:#fff;
    }
    .spinner{
      width:40px; height:40px;
      border:4px solid rgba(255,255,255,.12);
      border-top-color: var(--green);
      border-radius:50%;
      animation:spin 1s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg);}}


    /* Responsive */
    @media (max-width: 920px){
      .hero-grid{ grid-template-columns: 1fr; }
      .grid{ grid-template-columns: 1fr; }
      .howgrid{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>

  <!-- NAV -->
  <div class="nav" id="top">
    <div class="container">
      <div class="nav-inner">
        <div class="brand">
          <div class="brandMark">SG</div>
          <div class="brandTxt">
            <div class="t1">Shah Ghouse √ó MenuVista</div>
            <div class="t2">5 Signature Dishes ‚Ä¢ 3D + Smart AR</div>
          </div>
        </div>

        <div class="navActions">
          <a class="btn" href="#dishes">View Dishes</a>
          <a class="btn btn-primary" href="#howto">How to Use</a>
        </div>
      </div>
    </div>
  </div>

  <!-- HERO -->
  <div class="hero">
    <div class="container">
      <div class="hero-grid">

        <div>
          <div class="pill">‚ú® No App ‚Ä¢ QR Based ‚Ä¢ Smart AR</div>
          <h1>Experience Shah Ghouse on your table ‚Äî in 3D + AR.</h1>
          <p>
            This is a pilot demo built with MenuVista. Preview dishes in 3D,
            then tap <b>View in AR</b>. If your device doesn‚Äôt support native AR, MenuVista automatically opens
            <b>Compatibility Mode</b> (camera overlay experience).
          </p>

          <div class="heroActions">
            <a class="btn btn-primary" href="#dishes">üöÄ Start AR Demo</a>
            <a class="btn btn-ghost" href="#howto">üì± Steps</a>
          </div>
        </div>

        <div class="heroCard">
          <div class="mini">‚úÖ What customers experience</div>
          <div class="stats">
            <div class="stat">
              <div class="k">3D Preview</div>
              <div class="d">Rotate + zoom instantly</div>
            </div>
            <div class="stat">
              <div class="k">Smart AR</div>
              <div class="d">Auto device detect</div>
            </div>
            <div class="stat">
              <div class="k">Compatibility Mode</div>
              <div class="d">Works on all phones</div>
            </div>
            <div class="stat">
              <div class="k">Premium Experience</div>
              <div class="d">Modern restaurant feel</div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- DISHES -->
  <section id="dishes">
    <div class="container">
      <div class="section-title">
        <div>
          <h2>5 Signature AR Dishes</h2>
          <p>Only selected signature dishes are shown in AR for maximum impact.</p>
        </div>
      </div>

      <div class="grid" id="dishGrid"></div>
    </div>
  </section>

  <!-- HOW TO -->
  <section id="howto">
    <div class="container">
      <div class="howbox">
        <div class="section-title" style="margin-bottom:0;">
          <div>
            <h2>How to use AR (Customer Guide)</h2>
            <p>Tap any dish ‚Üí press View in AR ‚Üí allow camera permission ‚Üí place on table.</p>
          </div>
        </div>

        <div class="howgrid">
          <div class="howstep">
            <div class="no">01</div>
            <p><b>Preview</b> the dish in 3D by rotating & zooming.</p>
          </div>

          <div class="howstep">
            <div class="no">02</div>
            <p>Tap <b>View in AR</b>. Native AR opens if supported.</p>
          </div>

          <div class="howstep">
            <div class="no">03</div>
            <p>If AR isn‚Äôt supported, <b>Compatibility Mode</b> opens automatically.</p>
          </div>
        </div>

        <div style="margin-top:14px; display:flex; gap:10px; flex-wrap:wrap;">
          <a class="btn btn-primary" href="#dishes">‚ú® Try AR Now</a>
          <a class="btn" href="#top">‚¨Ü Back to top</a>
        </div>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <div class="container">
      <div class="foot">
        <div>¬© <span id="year"></span> MenuVista Demo ‚Ä¢ Shah Ghouse Pilot</div>
        <div style="font-weight:800;">Built with 3D + Smart AR ‚Ä¢ No app required</div>
      </div>
    </div>
  </footer>

  <!-- FALLBACK AR SCREEN -->
  <div class="fakeArScreen" id="fakeArScreen">
    <video class="fakeArVideo" id="fakeArVideo" autoplay muted playsinline></video>

    <div class="fakeArViewerWrap">
      <model-viewer
        id="fakeArModel"
        src=""
        camera-controls
        min-camera-orbit="auto 0deg auto"
        max-camera-orbit="auto 85deg auto"
        min-field-of-view="20deg"
        max-field-of-view="50deg"
        interpolation-decay="200"
        shadow-intensity="0"
        exposure="1.2"
        style="width:100%; height:100%; background:transparent;">
      </model-viewer>
    </div>

    <div class="fakeArOverlay">
      <div class="fakeArTopBar">
        <div class="fakeArTag">üì∑ Compatibility Mode</div>
        <button class="fakeArClose" onclick="closeFallbackAR()">Close ‚úñ</button>
      </div>

      <div class="fakeArBottomBar">
  <div>
    <div class="fakeArTitle" id="fakeArDishTitle">Dish Name</div>
    <div class="fakeArSub">
      ‚òùÔ∏è Rotate ‚Ä¢ ‚úåÔ∏è Move ‚Ä¢ ü§è Zoom
    </div>
  </div>

  <button
    class="fakeArSnapBtn"
    onclick="snapAndShare()"
    style="
      margin-left:10px;
      padding:12px 14px;
      border-radius:16px;
      border:0;
      background:linear-gradient(135deg,#16a34a,#15803d);
      color:#fff;
      font-weight:900;
      cursor:pointer;
      white-space:nowrap;
    "
  >
    üì∏ Snap & Share
  </button>
</div>

    </div>
  </div>

  <!-- LOADER -->
  <div class="loader" id="loader">
    <div class="spinner"></div>
    <div style="margin-top:14px; font-weight:900;">Loading AR...</div>
  </div>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    // ‚úÖ 5 Dish Data (GLB Only)
    const dishes = [
      {
        id: "mandi",
        name: "Signature Mandi Platter (Family Size)",
        tag: "Best Seller",
        subline: "AR Recommended ‚Ä¢ Premium Showcase",
        model: "shaami.glb"
      },
      {
        id: "biryani",
        name: "Royal Mutton Biryani (Premium Edition)",
        tag: "Must Try",
        subline: "Signature Main Course",
        model: "biryani.glb"
      },
      {
        id: "grill",
        name: "Chef‚Äôs Special Mixed Grill Platter",
        tag: "Special",
        subline: "Grills ‚Ä¢ Premium Plate",
        model: "grill.glb"
      },
      {
        id: "starter",
        name: "Signature Starter Platter",
        tag: "Trending",
        subline: "Perfect for sharing",
        model: "starter.glb"
      },
      {
        id: "dessert",
        name: "Dessert of the Day (Special Showcase)",
        tag: "Limited",
        subline: "Sweet Finish ‚Ä¢ AR Showcase",
        model: "dessert.glb"
      }
    ];

    // ‚úÖ Render Dish Cards
    const grid = document.getElementById("dishGrid");

    function renderDishes(){
      grid.innerHTML = "";

      dishes.forEach(item => {
        const card = document.createElement("div");
        card.className = "dish";

        card.innerHTML = `
          <div class="dish-top">
            <div>
              <h3>${item.name}</h3>
              <div class="subline">${item.subline}</div>
            </div>
            <span class="tag">${item.tag}</span>
          </div>

          <div class="viewer">
            <model-viewer
              id="mv-${item.id}"
              src="${item.model}"
              ar
              ar-modes="webxr quick-look"
              camera-controls
              auto-rotate
              shadow-intensity="1"
              alt="${item.name}">
            </model-viewer>
          </div>

          <div class="dish-actions">
            <button class="btn btn-primary btn-wide" onclick="openSmartAR('${item.id}')">
              ‚ú® View in AR
            </button>
            <a class="btn btn-wide btn-ghost" href="#howto">
              üì± Help
            </a>
          </div>
        `;

        grid.appendChild(card);
      });
    }

    renderDishes();

    // ================= üß† SMART AR LOGIC =================
    async function openSmartAR(itemId) {
      const item = dishes.find(d => d.id === itemId);
      if(!item) return;

      const viewer = document.getElementById(`mv-${itemId}`);
      const loader = document.getElementById("loader");

      // STEP 1: Try Native AR (if supported)
      const supportsNativeAR = viewer?.canActivateAR;

      if (supportsNativeAR) {
        try {
          viewer.activateAR();
          return;
        } catch (e) {
          console.warn("Native AR failed. Switching to fallback...", e);
        }
      }

      // STEP 2: Fallback (Camera Overlay)
      loader.style.display = "flex";

      setTimeout(() => {
        startFallbackAR(item);
        loader.style.display = "none";
      }, 450);
    }

    // ================= üì∑ FALLBACK CAMERA LOGIC =================
    let currentStream = null;

    async function startFallbackAR(item) {
      const fakeScreen = document.getElementById("fakeArScreen");
      const fakeVideo  = document.getElementById("fakeArVideo");
      const fakeModel  = document.getElementById("fakeArModel");
      const fakeTitle  = document.getElementById("fakeArDishTitle");

      // UI setup
      fakeModel.src = item.model;
      fakeTitle.innerText = item.name;
      fakeScreen.style.display = "block";

      // HTTPS check
      if (location.protocol !== "https:" && location.hostname !== "localhost") {
        alert("‚ö†Ô∏è Compatibility Mode requires HTTPS.\nHost on Netlify/Vercel for camera access.");
        return;
      }

      // Start camera
      try {
        const stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: "environment" },
          audio: false
        });

        currentStream = stream;
        fakeVideo.srcObject = stream;
        fakeVideo.setAttribute("playsinline", true);
        await fakeVideo.play();

      } catch (err) {
        console.error("Camera Error:", err);
        fakeScreen.style.display = "none";
        alert("Camera permission denied or unavailable. Please allow camera access.");
      }
    }

    function closeFallbackAR() {
      const fakeScreen = document.getElementById("fakeArScreen");
      const fakeVideo  = document.getElementById("fakeArVideo");

      fakeScreen.style.display = "none";

      if (currentStream) {
        currentStream.getTracks().forEach(track => track.stop());
        currentStream = null;
      }
      fakeVideo.srcObject = null;
    }
    // ================= SNAP & SHARE SYSTEM =================
let lastSnapBlob = null;

function closeSnapModal(){
  document.getElementById("snapModal").style.display = "none";
}

function openSnapModal(imgUrl){
  const modal = document.getElementById("snapModal");
  const preview = document.getElementById("snapPreview");
  preview.src = imgUrl;
  modal.style.display = "flex";
}

async function snapAndShare(){
  // ‚úÖ Capture from fallback camera overlay screen
  const video = document.getElementById("fakeArVideo");
  const dishName = document.getElementById("fakeArDishTitle")?.innerText || "AR Dish";

  // ‚úÖ Branding (make it dynamic later for every restaurant)
  const restaurantName = "Shah Ghouse";
  const tagline = "3D + AR Menu Experience";
  const poweredBy = "Powered by MenuVista";

  if(!video || video.readyState < 2){
    alert("Camera not ready yet. Please wait 1 second and try again.");
    return;
  }

  // ‚úÖ Create poster canvas
  const canvas = document.createElement("canvas");
  const w = 1080;
  const h = 1920;
  canvas.width = w;
  canvas.height = h;

  const ctx = canvas.getContext("2d");

  // Draw video frame as background (story size)
  ctx.drawImage(video, 0, 0, w, h);

  // Dark gradient overlay for readability
  const grad = ctx.createLinearGradient(0, 0, 0, h);
  grad.addColorStop(0, "rgba(0,0,0,0.55)");
  grad.addColorStop(0.35, "rgba(0,0,0,0.20)");
  grad.addColorStop(1, "rgba(0,0,0,0.55)");
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, w, h);

  // Top bar (restaurant name)
  ctx.fillStyle = "rgba(255,255,255,0.92)";
  ctx.font = "900 64px Inter, Arial";
  ctx.fillText(restaurantName, 60, 120);

  // Small tagline under restaurant name
  ctx.fillStyle = "rgba(255,255,255,0.85)";
  ctx.font = "800 36px Inter, Arial";
  ctx.fillText(tagline, 60, 175);

  // Dish name badge
  ctx.fillStyle = "rgba(22,163,74,0.95)";
  roundRect(ctx, 60, 240, 820, 90, 40);
  ctx.fill();

  ctx.fillStyle = "#fff";
  ctx.font = "900 42px Inter, Arial";
  ctx.fillText("‚ú® " + dishName, 90, 302);

  // Bottom branding
  ctx.fillStyle = "rgba(255,255,255,0.88)";
  ctx.font = "900 40px Inter, Arial";
  ctx.fillText(poweredBy, 60, h - 90);

  // Export PNG Blob
  const blob = await new Promise(resolve => canvas.toBlob(resolve, "image/png", 1.0));
  lastSnapBlob = blob;

  const imgUrl = URL.createObjectURL(blob);
  openSnapModal(imgUrl);
}

// helper for rounded rectangles
function roundRect(ctx, x, y, width, height, radius){
  ctx.beginPath();
  ctx.moveTo(x + radius, y);
  ctx.arcTo(x + width, y, x + width, y + height, radius);
  ctx.arcTo(x + width, y + height, x, y + height, radius);
  ctx.arcTo(x, y + height, x, y, radius);
  ctx.arcTo(x, y, x + width, y, radius);
  ctx.closePath();
}

async function shareSnap(){
  if(!lastSnapBlob){
    alert("No snap found. Please capture again.");
    return;
  }

  const file = new File([lastSnapBlob], "menuvista-ar-snap.png", { type: "image/png" });

  // ‚úÖ Native share support (mobile)
  if(navigator.canShare && navigator.canShare({ files: [file] })){
    try{
      await navigator.share({
        title: "MenuVista AR",
        text: "Check this AR food experience üî•",
        files: [file]
      });
    } catch(e){
      console.warn("Share cancelled or failed:", e);
    }
    return;
  }

  // ‚ùå If share not supported, fallback to download
  downloadSnap();
}

function downloadSnap(){
  if(!lastSnapBlob){
    alert("No snap found. Please capture again.");
    return;
  }
  const url = URL.createObjectURL(lastSnapBlob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "menuvista-ar-snap.png";
  document.body.appendChild(a);
  a.click();
  a.remove();
}

  </script>

<!-- SNAP PREVIEW MODAL -->
<div id="snapModal" style="
  position:fixed; inset:0; z-index:12000;
  background:rgba(0,0,0,.75);
  display:none;
  align-items:center; justify-content:center;
  padding:18px;
">
  <div style="
    width:min(420px, 100%);
    background:#fff;
    border-radius:22px;
    overflow:hidden;
    box-shadow:0 20px 60px rgba(0,0,0,.35);
  ">
    <div style="
      padding:14px 16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:1px solid rgba(15,23,42,.12);
      font-weight:900;
    ">
      <div>‚ú® Snap & Share</div>
      <button onclick="closeSnapModal()" style="
        border:1px solid rgba(15,23,42,.12);
        background:#fff;
        width:42px; height:42px;
        border-radius:14px;
        font-weight:900;
        cursor:pointer;
      ">‚úï</button>
    </div>

    <div style="padding:14px;">
      <img id="snapPreview" alt="Snap Preview" style="
        width:100%;
        border-radius:18px;
        border:1px solid rgba(15,23,42,.12);
        display:block;
      "/>

      <div style="display:flex; gap:10px; margin-top:12px; flex-wrap:wrap;">
        <button onclick="shareSnap()" style="
          flex:1;
          padding:12px 14px;
          border-radius:16px;
          border:0;
          background:linear-gradient(135deg,#16a34a,#15803d);
          color:#fff;
          font-weight:900;
          cursor:pointer;
        ">
          üì§ Share
        </button>

        <button onclick="downloadSnap()" style="
          flex:1;
          padding:12px 14px;
          border-radius:16px;
          border:1px solid rgba(15,23,42,.12);
          background:#fff;
          font-weight:900;
          cursor:pointer;
        ">
          ‚¨áÔ∏è Download
        </button>
      </div>

      <p style="margin:10px 0 0; font-size:12px; color:#475569; font-weight:700;">
        Tip: Share to Instagram Story / WhatsApp Status for the best impact.
      </p>
    </div>
  </div>
</div>

</body>
</html>
